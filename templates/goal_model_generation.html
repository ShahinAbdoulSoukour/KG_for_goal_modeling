{% extends "base.html" %}

{% block title %} Goal model generation {% endblock %}

{% block content %}
<br>
{% if hierarchy_data %}
    <!-- Goal model -->
    <div id="goal_model_div"></div>
{% else %}
<div class="alert alert-danger" role="alert">
    No data!
</div>
{% endif %}

<!-- TODO: Export the goal model into JPG/JPEG/XML -->

{% endblock %}


{% block scripts %}
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {packages:["orgchart"]});
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Name');
      data.addColumn('string', 'Manager');
      data.addColumn('string', 'ToolTip');

      // Get the hierarchy data
      var hierarchyData = {{ hierarchy_data|tojson }};

      // Create rows for the org chart
      var rows = hierarchyData.map(function(item) {
        return [
          {'v': '<a href="/contextualization/' + item.subgoal_id +'">' + item.subgoal_name + '</a>',
          'f': '<a href="/contextualization/' + item.subgoal_id +'">' + item.subgoal_name + '</a>'},
          '<a href="/contextualization/' + item.high_level_goal_id +'">' + item.high_level_goal_name + '</a>',
          'Goal'
        ];
      });

      // Add rows to the data table
      data.addRows(rows);

      // Create the chart
      var chart = new google.visualization.OrgChart(document.getElementById('goal_model_div'));
      // Draw the chart, setting the allowHtml option to true for the ToolTips
      chart.draw(data, {'allowHtml': true});

      google.visualization.events.addListener(chart, 'select', function() {
          console.log(chart.getSelection());
      });
    }

    $(document).ready(function () {
        $('#data_triples').DataTable();
    });
</script>
{% endblock %}